{"ast":null,"code":"var _jsxFileName = \"F:\\\\JAVA_WORKSPACE\\\\frontend_react-20191018T023535Z-001\\\\frontend_react\\\\src\\\\components\\\\chat\\\\chat.js\";\nimport React, { Component } from 'react';\nimport { Input, Table } from 'antd';\nimport './chat.css';\nimport SockJsClient from \"react-stomp\";\nimport UsernameGenerator from \"username-generator\";\nimport Fetch from \"json-fetch\";\nimport { TalkBox } from \"react-talk\";\nimport randomstring from \"randomstring\";\nimport { UserOutlined } from '@ant-design/icons';\n\nclass chat extends Component {\n  constructor(props, context) {\n    super(props);\n\n    this.onMessageReceive = (msg, topic) => {\n      debugger;\n      if (msg.author !== (this.nickName ? this.nickName : this.randomUserName)) this.setState(prevState => ({\n        messages: [...prevState.messages, msg]\n      }));\n      if (this.box) this.box.scrollToBottom();\n      console.log(this.box);\n\n      if (msg.cnt) {\n        this.cnt = msg.cnt;\n      } // this.scrollToBottom();\n      //$('.talk-box-body').animate({scrollTop: $('.talk-box-body').scrollHeight})\n\n    };\n\n    this.sendMessage = (msg, selfMsg) => {\n      // selfMsg is the message object constructed from the message typed by the current user\n      // NOTE: selfMsg doesn't include timestamp and needs to be added by the user of the module\n      // in client or server side as required\n      selfMsg[\"timestamp\"] = new Date().getTime();\n      this.setState(prevState => ({\n        messages: [...prevState.messages, selfMsg]\n      })); // If message sending failed return false otherwise return true\n\n      try {\n        // Insert code to send the message below\n        const s = {\n          name: this.nickName ? this.nickName : selfMsg.author,\n          session: \"0\",\n          content: msg,\n          timestamp: selfMsg[\"timestamp\"]\n        };\n        this.clientRef.sendMessage(\"/app/hello\", JSON.stringify(s));\n        return true;\n      } catch (e) {\n        return false;\n      }\n    };\n\n    this.nickChange = input => {\n      this.nickName = input.target.value;\n    };\n\n    this.randomUserName = UsernameGenerator.generateUsername(\"-\"); // this.randomUserId = randomstring.generate();\n\n    this.nickName = \"\";\n    this.box = null;\n\n    var ip = require(\"ip\");\n\n    this.randomUserId = ip.address();\n    this.cnt = 1;\n    columns = [{\n      title: 'Name',\n      dataIndex: 'name',\n      key: 'name'\n    }];\n    dataSource = [{\n      key: '1',\n      name: 'Mike',\n      age: 32,\n      address: '10 Downing Street'\n    }];\n    this.state = {\n      clientConnected: false,\n      messages: [//     {\n        //     \"author\": \"Ponger\",\n        //     \"authorId\": \"pong3\",\n        //     \"message\": \"How you doin'!\",\n        //     \"timestamp\": new Date().getTime()\n        // },\n        // {\n        //     \"author\": \"Ponger2\",\n        //     \"authorId\": \"pong4\",\n        //     \"message\": \"zzz!\",\n        //     \"timestamp\": Date.now().toString()\n        // }\n      ]\n    };\n  } //   componentWillMount() {\n  //     console.log(\"call history\");\n  //     Fetch(\"/history\", {\n  //       method: \"GET\"\n  //     }).then((response) => {\n  //       this.setState({ messages: response.body });\n  //     });\n  //   }\n\n\n  render() {\n    const wsSourceUrl = \"http://10.51.15.31:8076/chat\";\n    return /*#__PURE__*/React.createElement(\"div\", {\n      id: \"chat-viewer\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 119,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      id: \"nic-name\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 120,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(Input, {\n      size: \"large\",\n      placeholder: \"\\uB2C9\\uB124\\uC784\\uC744 \\uC785\\uB825\\uD558\\uC138\\uC694\",\n      prefix: /*#__PURE__*/React.createElement(UserOutlined, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 121,\n          columnNumber: 70\n        }\n      }),\n      onChange: this.nickChange,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 121,\n        columnNumber: 17\n      }\n    })), /*#__PURE__*/React.createElement(\"div\", {\n      id: \"chat-content\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 123,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(TalkBox, {\n      topic: \"\\uB300\\uD654\\uBC29\\u314E\\u314E\",\n      currentUserId: this.randomUserId,\n      currentUser: this.nickName ? this.nickName : this.randomUserName,\n      messages: this.state.messages,\n      onSendMessage: this.sendMessage,\n      connected: this.state.clientConnected,\n      onKeyDown: this.updateInputValue,\n      ref: _ref => {\n        this.box = _ref;\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 124,\n        columnNumber: 13\n      }\n    }), /*#__PURE__*/React.createElement(Table, {\n      dataSource: dataSource,\n      columns: columns,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 133,\n        columnNumber: 11\n      }\n    }), \"; \\uD604\\uC7AC\\uC785\\uC7A5\\uC778\\uC6D0:\", this.cnt, /*#__PURE__*/React.createElement(SockJsClient, {\n      url: wsSourceUrl,\n      topics: [\"/topics/testchat\"],\n      onMessage: this.onMessageReceive,\n      ref: client => {\n        this.clientRef = client;\n      },\n      onConnect: () => {\n        this.setState({\n          clientConnected: true\n        });\n      },\n      onDisconnect: () => {\n        this.setState({\n          clientConnected: false\n        });\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 138,\n        columnNumber: 13\n      }\n    })));\n  }\n\n}\n\nexport default chat;","map":{"version":3,"sources":["F:/JAVA_WORKSPACE/frontend_react-20191018T023535Z-001/frontend_react/src/components/chat/chat.js"],"names":["React","Component","Input","Table","SockJsClient","UsernameGenerator","Fetch","TalkBox","randomstring","UserOutlined","chat","constructor","props","context","onMessageReceive","msg","topic","author","nickName","randomUserName","setState","prevState","messages","box","scrollToBottom","console","log","cnt","sendMessage","selfMsg","Date","getTime","s","name","session","content","timestamp","clientRef","JSON","stringify","e","nickChange","input","target","value","generateUsername","ip","require","randomUserId","address","columns","title","dataIndex","key","dataSource","age","state","clientConnected","render","wsSourceUrl","updateInputValue","ref","client"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\r\nimport {Input,Table} from 'antd';\r\nimport './chat.css';\r\nimport SockJsClient  from \"react-stomp\";\r\nimport UsernameGenerator from \"username-generator\";\r\nimport Fetch from \"json-fetch\";\r\nimport { TalkBox } from \"react-talk\";\r\nimport randomstring from\"randomstring\";\r\nimport { UserOutlined } from '@ant-design/icons';\r\n\r\n\r\nclass chat extends Component {\r\n\r\n    constructor(props, context) {\r\n        super(props);\r\n\r\n        this.randomUserName = UsernameGenerator.generateUsername(\"-\");\r\n        // this.randomUserId = randomstring.generate();\r\n        this.nickName = \"\";\r\n        this.box=null;\r\n        var ip = require(\"ip\");\r\n        this.randomUserId = ip.address()\r\n         this.cnt=1;\r\n\r\n         columns = [\r\n          {\r\n            title: 'Name',\r\n            dataIndex: 'name',\r\n            key: 'name',\r\n          }];\r\n          dataSource = [\r\n            {\r\n              key: '1',\r\n              name: 'Mike',\r\n              age: 32,\r\n              address: '10 Downing Street',\r\n            }];\r\n       this.state = {\r\n            clientConnected:false,\r\n            messages: [\r\n            //     {\r\n\r\n            //     \"author\": \"Ponger\",\r\n            //     \"authorId\": \"pong3\",\r\n            //     \"message\": \"How you doin'!\",\r\n            //     \"timestamp\": new Date().getTime()\r\n            // },\r\n            // {\r\n            //     \"author\": \"Ponger2\",\r\n            //     \"authorId\": \"pong4\",\r\n            //     \"message\": \"zzz!\",\r\n            //     \"timestamp\": Date.now().toString()\r\n            // }\r\n        ]\r\n            \r\n        }\r\n    }\r\n    \r\n\r\n\r\n    //   componentWillMount() {\r\n    //     console.log(\"call history\");\r\n    //     Fetch(\"/history\", {\r\n    //       method: \"GET\"\r\n    //     }).then((response) => {\r\n    //       this.setState({ messages: response.body });\r\n    //     });\r\n    //   }\r\n\r\n          onMessageReceive = (msg, topic) => {\r\n            debugger\r\n            if(msg.author !== (this.nickName ? this.nickName  : this.randomUserName))\r\n            this.setState(prevState => ({\r\n              messages: [...prevState.messages, msg]\r\n            }));\r\n\r\n              if(this.box)\r\n              this.box.scrollToBottom();\r\n              console.log(this.box);\r\n\r\n              if(msg.cnt){\r\n                this.cnt = msg.cnt;\r\n              }\r\n           // this.scrollToBottom();\r\n            //$('.talk-box-body').animate({scrollTop: $('.talk-box-body').scrollHeight})\r\n            \r\n          }\r\n\r\n          sendMessage = (msg, selfMsg) => {\r\n            // selfMsg is the message object constructed from the message typed by the current user\r\n            // NOTE: selfMsg doesn't include timestamp and needs to be added by the user of the module\r\n            // in client or server side as required\r\n\r\n            selfMsg[\"timestamp\"] = new Date().getTime();\r\n            this.setState(prevState => ({\r\n                messages: [...prevState.messages, selfMsg]\r\n            }));\r\n            // If message sending failed return false otherwise return true\r\n            try {\r\n              // Insert code to send the message below\r\n\r\n              const s = {name: this.nickName ? this.nickName  : selfMsg.author, session: \"0\", content: msg,timestamp:selfMsg[\"timestamp\"]}\r\n              this.clientRef.sendMessage(\"/app/hello\", JSON.stringify(s));\r\n              \r\n              return true;\r\n            } catch (e) {\r\n              return false;\r\n            }\r\n          }\r\n\r\n          nickChange = (input)=>{\r\n            this.nickName  = input.target.value\r\n          }\r\n      \r\n\r\n    render() {\r\n        const wsSourceUrl = \"http://10.51.15.31:8076/chat\";\r\n        return (\r\n            <div id=\"chat-viewer\">\r\n                <div id=\"nic-name\">\r\n                <Input size=\"large\" placeholder=\"닉네임을 입력하세요\" prefix={<UserOutlined />} onChange={this.nickChange}/>\r\n                </div>\r\n                <div id=\"chat-content\">\r\n            <TalkBox topic=\"대화방ㅎㅎ\" currentUserId={ this.randomUserId }\r\n                currentUser={this.nickName ? this.nickName  : this.randomUserName} messages={this.state.messages}\r\n               onSendMessage={ this.sendMessage } connected={this.state.clientConnected}\r\n               onKeyDown={this.updateInputValue}\r\n               ref={ref => {\r\n                this.box = ref;\r\n              }}\r\n               />\r\n               \r\n          <Table dataSource={dataSource} columns={columns} />;\r\n\r\n\r\n               현재입장인원:{this.cnt}\r\n\r\n            <SockJsClient\r\n            url={wsSourceUrl}\r\n            topics={[\"/topics/testchat\"]}\r\n            onMessage={this.onMessageReceive }\r\n            ref={(client) => { this.clientRef = client; }} \r\n            onConnect={ () => {this.setState({ clientConnected: true }) } }\r\n            onDisconnect={ () => { this.setState({ clientConnected: false }) } }\r\n            />\r\n            </div>\r\n            </div>\r\n        );\r\n    }\r\n}\r\n\r\nexport default chat;"]},"metadata":{},"sourceType":"module"}